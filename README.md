# 基于整数规划的节假日火车出行决策优化建模与应用

这是一个基于Python的列车出行优化系统，用于帮助用户根据多个目的地的效用值、难度系数以及交通时间限制，找到最优的旅行方案。

## 功能特点

- 多目的地优化选择
- 考虑交通预算限制
- 自定义时间窗口设置
- 停留时间约束
- 可调节的难度权重系数
- 图形用户界面
- 支持多个最优解的输出
- JSON格式数据导入

## 系统要求

- Python 3.6+
- 依赖包：
  - pulp (线性规划求解器)
  - tabulate (表格输出)
  - tkinter (GUI界面，Python标准库)

## 安装步骤

1. 克隆或下载本项目到本地
2. 安装所需依赖：
```bash
pip install pulp tabulate
```

## 使用说明

### 1. 准备数据文件

创建一个JSON格式的数据文件，包含以下信息：
- destinations: 目的地列表
- params: 每个目的地的参数（效用U、难度D、最短和最长停留时间）
- outbound_trips: 去程车次信息
- return_trips: 返程车次信息

示例数据格式：
```json
{
    "destinations": ["A", "B", "C"],
    "params": {
        "A": {
            "U": 100,
            "D": 20,
            "min_stay_hours": 24,
            "max_stay_hours": 72
        },
        ...
    },
    "outbound_trips": {
        "A": {
            "G101": {
                "dep_time": 8,
                "arr_time": 12,
                "cost": 200
            },
            ...
        },
        ...
    },
    "return_trips": {
        ...
    }
}
```

### 2. 运行程序

1. 运行主程序：
```bash
python OR.py
```

2. 在GUI界面中：
   - 调整参数设置：
     * 惩罚系数(α)：难度的权重系数
     * 交通预算：最大允许的交通费用
     * 出发时间窗口：允许的出发时间范围（0-24小时）
     * 返程时间窗口：允许的返程时间范围（0-168小时）
   
   - 选择数据文件：
     * 默认加载 "edited_travel_data.json"
     * 可通过"浏览"按钮选择其他JSON文件

   - 点击"求解"按钮开始优化计算

### 3. 查看结果

结果将以表格形式显示，包含以下信息：
- 目的地
- 去程车次及票价
- 返程车次及票价
- 总交通成本
- 停留时间
- 各项约束的合规性检查
- 目标值（效用-难度*α）

## 数据编辑工具

本项目还提供了一个数据编辑工具（data_editor.py），用于：
- 创建新的数据文件
- 编辑现有数据文件
- 添加/修改目的地信息
- 管理车次信息

运行数据编辑工具：
```bash
python data_editor.py
```

## 注意事项

1. 时间窗口设置：
   - 出发时间窗口必须在0-24小时范围内
   - 返程时间窗口必须在0-168小时（一周）范围内
   - 起始时间必须小于结束时间

2. 参数限制：
   - 惩罚系数必须为非负数
   - 预算必须为正数
   - 停留时间必须符合目的地的限制

3. 数据文件格式：
   - 必须是有效的JSON格式
   - 包含所有必需的键值
   - 数据类型必须正确

## 错误处理

程序会对以下情况进行错误提示：
- 文件不存在
- JSON格式无效
- 缺少必需的数据字段
- 参数值无效
- 求解过程出错

